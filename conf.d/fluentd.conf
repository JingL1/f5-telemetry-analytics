<source>
    @type http
    port 8081
</source>

<filter myapp.access>
    @type record_transformer
    <record>
        hostname "#{Socket.gethostname}"
    </record>
</filter>

<filter geoip.access>
    @type geoip

    geoip_lookup_keys host

    backend_library geoip2_c

    <record>
        city            ${city.names.en["host"]}
        latitude        ${location.latitude["host"]}
        longtitude       ${location.longitude["host"]}
        country         ${country.iso_code["host"]}
        country_name    ${country.names.en["host"]}
    </record>
</filter>

<match myapp.access>
    @type copy
    <store>
        @type stdout
    </store>
    <store>
        @type elasticsearch
        host elasticsearch
        port 9200
        logstash_format true
        logstash_prefix fluentd
        include_tag_key true
        type_name access_log
        tag_key @log_name
        flush_interval 1s
    </store>
</match>

<match geoip.access>
    @type copy
    <store>
        @type stdout
    </store>
</match>